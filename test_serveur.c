#include <stdio.h>
#include <pthread.h>
#include <stdlib.h>	
#include <time.h>		
#include <unistd.h>	

pthread_mutex_t m1, m2;

//variable qui représente les deux serveurs
int estDispoProd=0;
int estDispoBack=0;

int mon_rand(int a, int b)
{
	return ( rand()%(b-a) ) + a;
}

void* dispo_serveur_prod()
{
	int a = mon_rand(1,5);
	sleep(a);
	pthread_mutex_lock(&m1);

	//pour dire que le serveur de production est disponible ou non
	estDispoProd=1;
	if(estDispoBack == 1)
	{
			printf("Le serveur de la prodution est indisponible\n");
	}
	else
	{
			printf("Le serveur de la production est disponible\n");
	}
	pthread_mutex_unlock(&m2);

}

void* dispo_serveur_back_up()
{
	int a = mon_rand(1,5);
	sleep(a);
	pthread_mutex_lock(&m2);

	//pour dire que le serveur de back up est disponible ou non
	estDispoBack=1;
	if(estDispoProd == 1)
	{
			printf("Le serveur de la back up est indisponible\n");
	}
	else
	{
			printf("Le serveur de la back up est disponible\n");
	}
	pthread_mutex_unlock(&m1);

}

void test_serveur(void)
{
	//création des threads pour le serveur de production et pour le serveur de backup
	pthread_t mes_threads[2];

	srand(time(NULL));

	pthread_create(&mes_threads[0],NULL,dispo_serveur_prod,NULL);
	pthread_create(&mes_threads[1],NULL,dispo_serveur_back_up,NULL);

	pthread_join(mes_threads[0],NULL);
	pthread_join(mes_threads[1],NULL);

	//A deverouiller pour les prochaines executions
	pthread_mutex_unlock(&m1);
	pthread_mutex_unlock(&m2);

	return;
} 
